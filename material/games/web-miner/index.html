

<html>
<head>
<title>Web Miner</title>

<style>
	#gameArea {
		position : absolute;
		top      : 50%;
		left     : 50%;
		transform: translate(-50%, -50%);
		width    : 640;
		height   : 512;
		background-color: #dddddd;
	}
</style>




<script>

const Key = {
    "left": 0, "right": 1, "up": 2, "down": 3, "reset": 4
}


function Game(gameArea) {
	this._gameArea = gameArea;
	this._gameArea.focus();
	
	/*
	var audio = new Audio('./assets/diamond.wav');
	audio.play();
	*/

    this._soundPlayer = new SoundPlayer();
    this._soundPlayer.load("diamond", "url('./assets/diamond.wav')" ); 
    this._soundPlayer.load("stone", "url('./assets/stone.wav')" ); 
    this._soundPlayer.load("step", "url('./assets/step.wav')" ); 
    var self = this;

	self.start();
};

Game.prototype.start = function () {

    var self = this;
		
    this._mouseDownHandler  = function (e) { self.mouseDown(e);  };
    this._touchStartHandler = function (e) { self.touchStart(e); };
    this._touchEndHandler   = function (e) { self.touchEnd(e);   };
    this._touchMoveHandler  = function (e) { self.touchMove(e);  };
    this._keyDownHandler    = function (e) { self.keyDown(e);    };
    this._keyUpHandler      = function (e) { self.keyUp(e);      };

	this._gameArea.addEventListener("touchstart", this._touchStartHandler, false);
    this._gameArea.addEventListener("touchmove",  this._touchMoveHandler,  false);
    this._gameArea.addEventListener("touchend",   this._touchEndHandler,   false);
    this._gameArea.addEventListener("mousedown",  this._mouseDownHandler,  false);
	
    document.addEventListener("keydown", this._keyDownHandler, false);
    document.addEventListener("keyup",   this._keyUpHandler,   false);
    this._blink = 0;
    this.reset();
    window.setInterval(function () { return self.interval(); }, 50);
};

Game.prototype.addKey = function (key) {
    if (key < 4) {
        this._keys[key] = true;
    }
    else if (key == Key.reset) {
        this._lives--;
        if (this._lives >= 0) {
            this.loadLevel();
        }
        else {
            this.reset();
        }
    }
};

Game.prototype.removeKey = function (key) {
    if (key < 4) {
        this._keysRelease[key] = true;
    }
};

Game.prototype.reset = function () {
    this._lives       = 20;
    this._score       = 0;
    this._room        = 0;
    this.loadLevel();
	
	this._fontIndex = 0;
	this._font = [];
	for (var c = 0; c < 100; c++) {
		let div = document.createElement( 'div' );
		div.style.backgroundImage     = "url('./assets/font.png')";
		div.style.backgroundPosition  = "-0px -0px";
		div.style.position            = "absolute";
		div.style.backgroundColor     = "blue";
		div.style.padding             = 0;
		div.style.margin              = 0;
		this._gameArea.appendChild( div );
		this._font.push( div );
    }
	
	
	this._divs = [];
    for (var x = 0; x < 20; x++) {
        for (var y = 0; y < 14; y++) {
			
			let div = document.createElement( 'div' );
			var spriteIndex = this._level.getSpriteIndex(x, y, 0);
			
			div.style.backgroundImage     = "url('./assets/sprite.png')";
			div.style.backgroundPosition  = "-0px -0px";
			div.style.position            = "absolute";
			div.style.backgroundColor     = "black";
			div.style.padding             = 0;
			div.style.margin              = 0;
			

			/*
			{
				let tx = spriteIndex * 16 * 2;
				let ty = 0;
				
				//let div 					  = this._divs[x + y*20];
				div.style.left  			  = ( x * 16 * 2 ) + "px";
				div.style.top   			  = ( y * (16 * 2) + (32 * 2) ) + "px";
				div.style.width 			  = (16 * 2) + "px";
				div.style.height			  = (16 * 2) + "px";
				div.style.backgroundPosition  = "-"+tx+"px -"+ty+"px";
			}
			
			if ( spriteIndex >= 7 && spriteIndex <= 13 )
			{	
				div.style.backgroundImage     = "url('./assets/gem3.gif')";
				div.style.backgroundPosition  = "-0px -0px";
			}
			*/
			
			this._gameArea.appendChild( div );
			this._divs[ x + y*20 ] = div;
			//this._divs.push( div ); 
        }
    }
	
};

Game.prototype.loadLevel = function () {
    this._level       = new Level(levelData[this._room]);
    this._keys        = [false, false, false, false];
    this._keysRelease = [false, false, false, false];
    this._tick        = 0;
    //this.paint();
};

Game.prototype.nextLevel = function () {
    if (this._room < (levelData.length - 1)) {
        this._room++;
        this.loadLevel();
    }
};

Game.prototype.isPlayerAlive = function () {
    return (this._level === null) || (this._level.isPlayerAlive());
};

Game.prototype.interval = function () {
    this._tick++;
    this._blink++;
    if (this._blink == 6) {
        this._blink = 0;
    }
    if ((this._tick % 2) === 0) {
        // keyboard
        for (var i = 0; i < 4; i++) {
            if (this._keysRelease[i]) {
                this._keys[i]        = false;
                this._keysRelease[i] = false;
            }
        }
        this._level.update();
        if (this._level.movePlayer(this._keys)) {
            this.nextLevel();
        }
        else {
            this._level.move();
            // play sound
            var soundTable = ["diamond", "stone", "step"];
            for (var i = 0; i < soundTable.length; i++) {
                if (this._level.playSound(i) && this._soundPlayer.play(soundTable[i])) {
                    break;
                }
            }
        }
    }
    this._score       += this._level.score;
    this._level.score = 0;
    this.paint();
};

Game.prototype.paint = function () {
    var blink = ((this._blink + 4) % 6);
    // update statusbar
	this._fontIndex = 0;
	this.drawText(0     , 8  , "  ROOM:     TIME:        DIAMONDS:      "  );
    this.drawText(0     , 16 , "  LIVES:    SCORE:       COLLECTED:     "  );
    this.drawText(9 * 8 , 8  , this.formatNumber(this._room + 1, 2)        );
    this.drawText(9 * 8 , 16 , this.formatNumber(this._lives, 2)           );
    this.drawText(19 * 8, 16 , this.formatNumber(this._score, 5)           );
    this.drawText(19 * 8, 8  , this.formatNumber(this._level.time, 5)      );
    this.drawText(36 * 8, 8  , this.formatNumber(this._level.diamonds, 2)  );
    this.drawText(36 * 8, 16 , this.formatNumber(this._level.collected, 2) );
    // update sprite images
    for (var x = 0; x < 20; x++) {
        for (var y = 0; y < 14; y++) {
            var spriteIndex = this._level.getSpriteIndex(x, y, blink);
			

			let tx = spriteIndex * 16 * 2;
			let ty = 0;
			
			let div 					  = this._divs[x + y*20];
			div.style.left  			  = ( x * 16 * 2 ) + "px";
			div.style.top   			  = ( y * (16 * 2) + (32 * 2) ) + "px";
			div.style.width 			  = (16 * 2) + "px";
			div.style.height			  = (16 * 2) + "px";				
			div.style.backgroundPosition  = "-"+tx+"px -"+ty+"px";
			
			if ( spriteIndex >= 7 && spriteIndex <= 13 )
			{
				div.style.backgroundImage     = "url('./assets/gem2.gif')";
				div.style.backgroundPosition  = "-"+0+"px -"+0+"px";
			}
			else if ( spriteIndex === 14 )
			{
				div.style.backgroundImage     = "url('./assets/brick0.png')";
				div.style.backgroundPosition  = "-"+0+"px -"+0+"px";
			}
			else if ( spriteIndex === 2 )
			{
				div.style.backgroundImage     = "url('./assets/brick1.png')";
				div.style.backgroundPosition  = "-"+0+"px -"+0+"px";
			}
			else 
			{
				div.style.backgroundImage     = "url('./assets/sprite.png')";
			}

        }
    }
};
Game.prototype.drawText = function (x, y, text) {
    for (var i = 0; i < text.length; i++) {
        var index = text.charCodeAt(i) - 32;
		
		let tx = 0;
		let ty = index * 8 * 2;
		
		let div 					  = this._font[ this._fontIndex ];
		div.style.left  			  = ( x * 2 ) + "px";
		div.style.top   			  = ( y * 2 ) + "px";
		div.style.width 			  = (8 * 2) + "px";
		div.style.height			  = (8 * 2) + "px";				
		div.style.backgroundPosition  = "-"+tx+"px -"+ty+"px";
		this._fontIndex++;
		
		if ( this._fontIndex > 100 )
		{
			alert('font cache limit reached');
		}
        x += 8;
    }
};

Game.prototype.formatNumber = function (value, digits) {
    var text = value.toString();
    while (text.length < digits) {
        text = "0" + text;
    }
    return text;
};

Game.prototype.keyDown = function (e) {
    if (!e.ctrlKey && !e.altKey && !e.altKey && !e.metaKey) {
        var keyMap = { "37": Key.left, "39": Key.right, "38": Key.up, "40": Key.down, "27": Key.reset };
        if (e.keyCode in keyMap) {
            this.stopEvent(e);
            this.addKey(keyMap[e.keyCode]);
        }
        else if (e.keyCode == 8 || e.keyCode == 36) {
            this.stopEvent(e);
            this.nextLevel();
        }
        else if (!this.isPlayerAlive()) {
            this.stopEvent(e);
            this.addKey(Key.reset);
        }
    }
};

Game.prototype.keyUp = function (e) {
    var keyMap = { "37": Key.left, "39": Key.right, "38": Key.up, "40": Key.down };
    if (e.keyCode in keyMap) {
        this.stopEvent(e);
        this.removeKey(keyMap[e.keyCode]);
    }
};

Game.prototype.mouseDown = function (e) {
    e.preventDefault();
	this._gameArea.focus();
};

Game.prototype.touchStart = function (e) {
    e.preventDefault();
    if (e.touches.length > 3) {
        this.nextLevel();
    }
    else if ((e.touches.length > 2) || (!this.isPlayerAlive())) {
        this.addKey(Key.reset);
    }
    else {
        for (var i = 0; i < e.touches.length; i++) {
            this._touchPosition = new Position(e.touches[i].pageX, e.touches[i].pageY);
        }
    }
};

Game.prototype.touchMove = function (e) {
    e.preventDefault();
    for (var i = 0; i < e.touches.length; i++) {
        if (this._touchPosition !== null) {
            var x = e.touches[i].pageX;
            var y = e.touches[i].pageY;
            var direction = null;
            if ((this._touchPosition.x - x) > 20) {
                direction = Key.left;
            }
            else if ((this._touchPosition.x - x) < -20) {
                direction = Key.right;
            }
            else if ((this._touchPosition.y - y) > 20) {
                direction = Key.up;
            }
            else if ((this._touchPosition.y - y) < -20) {
                direction = Key.down;
            }
            if (direction !== null) {
                this._touchPosition = new Position(x, y);
                for (var i = Key.left; i <= Key.down; i++) {
                    if (direction == i) {
                        this.addKey(i);
                    }
                    else {
                        this.removeKey(i);
                    }
                }
            }
        }
    }
};

Game.prototype.touchEnd = function (e) {
    e.preventDefault();
    this._touchPosition = null;
    this.removeKey(Key.left);
    this.removeKey(Key.right);
    this.removeKey(Key.up);
    this.removeKey(Key.down);
};

Game.prototype.stopEvent = function (e) {
    e.preventDefault();
    e.stopPropagation();
};










function Base64Reader(data) {
    this._alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    this._position = 0;
    this._bits = 0;
    this._bitsLength = 0;
    this._data = data;
};

Base64Reader.prototype.readByte = function () {
    if (this._bitsLength === 0) {
        var tailBits = 0;
        while (this._position < this._data.length && this._bitsLength < 24) {
            var ch = this._data.charAt(this._position++);
            var index = this._alphabet.indexOf(ch);
            if (index < 64) {
                this._bits = (this._bits << 6) | index;
            }
            else {
                this._bits <<= 6;
                tailBits += 6;
            }
            this._bitsLength += 6;
        }
        if (this._position >= this._data.length && this._bitsLength === 0) {
            return -1;
        }
        tailBits = (tailBits === 6) ? 8 : (tailBits === 12) ? 16 : tailBits;
        this._bits = this._bits >> tailBits;
        this._bitsLength -= tailBits;
    }
    this._bitsLength -= 8;
    return (this._bits >> this._bitsLength) & 0xff;
};

var Direction = { 
    "none": 0, "left": 1, "right": 2, "up": 3, "down": 4 
};

function Ghost(position, type, direction, lastTurn) {
    this.alive = true;
    this.position = position;
    this.type = type;
    this.direction = direction;
    this.lastTurn = lastTurn;
}
Ghost.prototype.getImageIndex = function () {
    return [4, 4, 5, 6, 3][this.direction];
};

var Sprite = {
    "nothing": 0, "stone": 1, "ground": 2, "ghost180": 3, "uvexit": 4, 
    "diamond": 5, "wall": 6, "ghost90L": 7, "marker": 8, "uvstone": 9, "player": 10,
    "ghost90LR": 11, "exit": 12, "buffer": 13, "changer": 14, "ghost90R": 15,
};

function Level(data) {
    this.collected = 0;
    this.time = 5000;
    this.score = 0;
    this._map = [];
    for (var x = 0; x < 20; x++) {
        this._map[x] = [];
    }
    var reader = new Base64Reader(data);
    for (var y = 0; y < 14; y++) {
        for (var x = 0; x < 10; x++) {
            var b = reader.readByte();
            this._map[x * 2 + 1][y] = b & 0x0f;
            this._map[x * 2][y] = b >> 4;
        }
    }
    for (var i = 0; i < 5; i++) {
        reader.readByte();
    }
    var position = new Position(reader.readByte(), reader.readByte() - 2);
    this._player = new Player(position);
    this._map[this._player.position.x][this._player.position.y] = Sprite.player;
    this.diamonds = reader.readByte();
    this.diamonds = (this.diamonds >> 4) * 10 + (this.diamonds & 0x0f);
    var ghostData = [];
    for (var i = 0; i < 8; i++) {
        ghostData.push(reader.readByte());
    }
    var index = 0;
    this._ghosts = [];
    for (var y = 0; y < 14; y++) {
        for (var x = 0; x < 20; x++) {
            if (this.isGhost(x, y)) {
                var info = index & 1 !== 0 ? (ghostData[index >> 1] & 0x0f) : (ghostData[index >> 1] >> 4);
                var direction = info < 4 ? [Direction.down, Direction.up, Direction.right, Direction.left][info] : Direction.none;
                var lastTurn = index & 1 !== 0 ? Direction.right : Direction.left;
                this._ghosts.push(new Ghost(new Position(x, y), this._map[x][y], direction, lastTurn));
                index++;
            }
        }
    }
};

Level.prototype.isPlayerAlive = function () {
    return this._player.alive;
};

Level.prototype.update = function () {
    // turn buffers into nothing
    for (var y = 13; y >= 0; y--) {
        for (var x = 19; x >= 0; x--) {
            if (this._map[x][y] === Sprite.buffer) {
                this._map[x][y] = Sprite.nothing;
            }
        }
    }
    // reset sound state
    this._soundTable = [false, false, false];
};

Level.prototype.playSound = function (sound) {
    return this._soundTable[sound];
};


Level.prototype.move = function () {
    // gravity for stones and diamonds
    for (var y = 13; y >= 0; y--) {
        for (var x = 19; x >= 0; x--) {
            if (this._map[x][y] === Sprite.stone || this._map[x][y] === Sprite.diamond || this._map[x][y] === Sprite.uvstone) {
                var dx = x;
                var dy = y;
                if (this._map[x][y + 1] === Sprite.nothing) {
                    dy = y + 1;
                }
                else {
                    if (this._map[x][y + 1] === Sprite.stone || this._map[x][y + 1] === Sprite.diamond) {
                        if (this._map[x - 1][y + 1] === Sprite.nothing && this._map[x - 1][y] === Sprite.nothing) {
                            dx = x - 1;
                            dy = y + 1;
                        }
                        else if (this._map[x + 1][y + 1] === Sprite.nothing && this._map[x + 1][y] === Sprite.nothing) {
                            dx = x + 1;
                            dy = y + 1;
                        }
                    }
                    if ((this._map[x][y + 1] === Sprite.changer) && ((this._map[x][y] === Sprite.stone) || (this._map[x][y] === Sprite.uvstone)) && (this._map[x][y + 2] === Sprite.nothing)) {
                        dy = y + 2;
                    }
                }
                if (dx != x || dy != y) {
                    this._map[dx][dy] = Sprite.marker;
                }
            }
        }
    }
    for (var y = 13; y >= 0; y--) {
        for (var x = 19; x >= 0; x--) {
            if (this._map[x][y] === Sprite.stone || this._map[x][y] === Sprite.diamond || this._map[x][y] === Sprite.uvstone) {
                var dx = x;
                var dy = y;
                if (this._map[x][y + 1] === Sprite.marker) {
                    dy = y + 1;
                }
                else {
                    if ((this._map[x][y + 1] === Sprite.stone) || (this._map[x][y + 1] === Sprite.diamond) || (this._map[x][y + 1] === Sprite.nothing)) {
                        if ((this._map[x - 1][y + 1] === Sprite.marker) && ((this._map[x - 1][y] === Sprite.nothing) || (this._map[x - 1][y] === Sprite.marker))) {
                            dx = x - 1;
                            dy = y + 1;
                        }
                        else if ((this._map[x + 1][y + 1] === Sprite.marker) && ((this._map[x + 1][y] === Sprite.nothing) || (this._map[x + 1][y] === Sprite.marker))) {
                            dx = x + 1;
                            dy = y + 1;
                        }
                    }
                    if ((this._map[x][y + 1] === Sprite.changer) && ((this._map[x][y] === Sprite.stone) || (this._map[x][y] === Sprite.uvstone)) && (this._map[x][y + 2] === Sprite.marker)) {
                        dy = y + 2;
                    }
                }
                if (dx != x || dy != y) {
                    if ((dy - y) === 2) {
                        this._map[dx][dy] = Sprite.diamond;
                    }
                    else {
                        this._map[dx][dy] = this._map[x][y];
                        if (this._map[dx][dy] === Sprite.uvstone) {
                            this._map[dx][dy] = Sprite.stone;
                        }
                    }
                    this._map[x][y] = Sprite.nothing;
                    if (this._map[dx][dy + 1] === Sprite.stone || this._map[dx][dy + 1] === Sprite.diamond || this._map[dx][dy + 1] === Sprite.wall || this.isGhost(dx, dy + 1)) {
                        this._soundTable[Sound.stone] = true;
                    }
                    if (this.isPlayer(dx, dy + 1)) {
                        this._player.kill();
                    }
                    if (this.isGhost(dx, dy + 1)) {
                        this.killGhost(dx, dy + 1);
                    }
                }
            }
        }
    }
    for (var i = 0; i < this._ghosts.length; i++) {
        this.moveGhost(this._ghosts[i]);
    }
    if (this.time > 0) {
        this.time--;
    }
    if (this.time === 0) {
        this._player.kill();
    }
};

Level.prototype.movePlayer = function (keys) {
    if (this._player.alive) {
        this._player.direction = Direction.none;
        var p = this._player.position.clone();
        var d = p.clone();
        var z = d.clone();
        if (keys[Key.left]) {
            z.x--;
            this._player.direction = Direction.left;
        }
        else {
            this._player.stone[0] = false;
            if (keys[Key.right]) {
                z.x++;
                this._player.direction = Direction.right;
            }
            else {
                this._player.stone[1] = false;
                if (keys[Key.up]) {
                    z.y--;
                    this._player.direction = Direction.up;
                }
                else if (keys[Key.down]) {
                    z.y++;
                    this._player.direction = Direction.down;
                }
            }
        }
        if (!d.equals(z)) {
            if (this._map[z.x][z.y] === Sprite.nothing) {
                this.placePlayer(d.x, d.y);
            }
            if (this._map[z.x][z.y] === Sprite.diamond) {
                this.collected += 1;
                this.score += 3;
                this._soundTable[Sound.diamond] = true;
            }
            if (this._map[z.x][z.y] === Sprite.stone) {
                if ((z.x > d.x) && (this._map[z.x + 1][z.y] === Sprite.nothing)) {
                    if (this._player.stone[1]) {
                        this._map[d.x + 2][d.y] = this._map[d.x + 1][d.y];
                        this._map[d.x + 1][d.y] = Sprite.nothing;
                    }
                    this._player.stone[1] = !this._player.stone[1];
                }
                if ((z.x < d.x) && (this._map[z.x - 1][z.y] === Sprite.nothing)) {
                    if (this._player.stone[0]) {
                        this._map[d.x - 2][d.y] = this._map[d.x - 1][d.y];
                        this._map[d.x - 1][d.y] = Sprite.nothing;
                    }
                    this._player.stone[0] = !this._player.stone[0];
                }
            }
            if (this._map[z.x][z.y] === Sprite.nothing || this._map[z.x][z.y] === Sprite.ground || this._map[z.x][z.y] === Sprite.diamond) {
                this.placePlayer(z.x, z.y);
                this._map[d.x][d.y] = Sprite.buffer;
                this._soundTable[Sound.step] = true;
            }
            if (this._map[z.x][z.y] === Sprite.exit || this._map[z.x][z.y] === Sprite.uvexit) {
                if (this.collected >= this.diamonds) {
                    return true; // next level
                }
            }
            if (this.isGhost(z.x, z.y)) {
                this._player.kill();
            }
        }
        // animate player
        this._player.animate();
    }
    return false;
};

Level.prototype.isPlayer = function (x, y) {
    return (this._map[x][y] === Sprite.player);
};

Level.prototype.placePlayer = function (x, y) {
    this._map[x][y] = Sprite.player;
    this._player.position.x = x;
    this._player.position.y = y;
};


Level.prototype.isGhost = function (x, y) {
    return this._map[x][y] === Sprite.ghost90L || this._map[x][y] === Sprite.ghost90R || this._map[x][y] === Sprite.ghost90LR || this._map[x][y] === Sprite.ghost180;
};


Level.prototype.moveGhost = function (ghost) {
    if (ghost.alive) {
        var p = ghost.position.clone();
        var w = [p.clone(), p.clone(), p.clone(), p.clone()];
        if (ghost.type === Sprite.ghost180 || ghost.type === Sprite.ghost90L || ghost.type === Sprite.ghost90R) {
            if (ghost.type === Sprite.ghost180) {
                if (ghost.direction === Direction.left) {
                    w[0].x--; w[1].x++;
                }
                if (ghost.direction === Direction.right) {
                    w[0].x++; w[1].x--;
                }
                if (ghost.direction === Direction.up) {
                    w[0].y--; w[1].y++;
                }
                if (ghost.direction === Direction.down) {
                    w[0].y++; w[1].y--;
                }
            }
            else if (ghost.type === Sprite.ghost90L) {
                if (ghost.direction === Direction.left) {
                    w[0].x--; w[1].y++; w[2].y--; w[3].x++;
                }
                if (ghost.direction === Direction.right) {
                    w[0].x++; w[1].y--; w[2].y++; w[3].x--;
                }
                if (ghost.direction === Direction.up) {
                    w[0].y--; w[1].x--; w[2].x++; w[3].y++;
                }
                if (ghost.direction === Direction.down) {
                    w[0].y++; w[1].x++; w[2].x--; w[3].y--;
                }
            }
            else if (ghost.type === Sprite.ghost90R) {
                if (ghost.direction === Direction.left) {
                    w[0].x--; w[1].y--; w[2].y++; w[3].x++;
                }
                if (ghost.direction === Direction.right) {
                    w[0].x++; w[1].y++; w[2].y--; w[3].x--;
                }
                if (ghost.direction === Direction.up) {
                    w[0].y--; w[1].x++; w[2].x--; w[3].y++;
                }
                if (ghost.direction === Direction.down) {
                    w[0].y++; w[1].x--; w[2].x++; w[3].y--;
                }
            }
            for (var i = 0; i < 4; i++) {
                if (!p.equals(w[i])) {
                    var d = w[i].clone();
                    if (this.isPlayer(d.x, d.y)) {
                        this._player.kill();
                    }
                    if (this._map[d.x][d.y] === Sprite.nothing) {
                        if (d.x < p.x) {
                            ghost.direction = Direction.left;
                        }
                        if (d.x > p.x) {
                            ghost.direction = Direction.right;
                        }
                        if (d.y < p.y) {
                            ghost.direction = Direction.up;
                        }
                        if (d.y > p.y) {
                            ghost.direction = Direction.down;
                        }
                        this.placeGhost(d.x, d.y, ghost);
                        this._map[p.x][p.y] = Sprite.nothing;
                        return;
                    }
                }
            }
        }
        else if (ghost.type === Sprite.ghost90LR) {
            if (ghost.direction === Direction.left) {
                w[0].x--; w[3].x++;
                if (ghost.lastTurn === Direction.left) {
                    w[1].y--; w[2].y++;
                }
                else {
                    w[1].y++; w[2].y--;
                }
            }
            else if (ghost.direction === Direction.right) {
                w[0].x++; w[3].x--;
                if (ghost.lastTurn === Direction.left) {
                    w[1].y++; w[2].y--;
                }
                else {
                    w[1].y--; w[2].y++;
                }
            }
            else if (ghost.direction === Direction.up) {
                w[0].y--; w[3].y++;
                if (ghost.lastTurn === Direction.left) {
                    w[1].x++; w[2].x--;
                }
                else {
                    w[1].x--; w[2].x++;
                }
            }
            else if (ghost.direction === Direction.down) {
                w[0].y++; w[3].y--;
                if (ghost.lastTurn === Direction.left) {
                    w[1].x--; w[2].x++;
                }
                else {
                    w[1].x++; w[2].x--;
                }
            }
            for (var i = 0; i < 4; i++) {
                if (!p.equals(w[i])) {
                    var d = w[i].clone();
                    if (this.isPlayer(d.x, d.y)) {
                        this._player.kill();
                    }
                    if (this._map[d.x][d.y] === Sprite.nothing) {
                        var lastDirection = ghost.direction;
                        if (d.x < p.x) {
                            ghost.direction = Direction.left;
                        }
                        if (d.x > p.x) {
                            ghost.direction = Direction.right;
                        }
                        if (d.y < p.y) {
                            ghost.direction = Direction.up;
                        }
                        if (d.y > p.y) {
                            ghost.direction = Direction.down;
                        }
                        if (lastDirection === Direction.left) {
                            if (ghost.direction === Direction.down) {
                                ghost.lastTurn = Direction.left;
                            }
                            if (ghost.direction === Direction.up) {
                                ghost.lastTurn = Direction.right;
                            }
                        }
                        else if (lastDirection === Direction.right) {
                            if (ghost.direction === Direction.down) {
                                ghost.lastTurn = Direction.right;
                            }
                            if (ghost.direction === Direction.up) {
                                ghost.lastTurn = Direction.left;
                            }
                        }
                        else if (lastDirection === Direction.up) {
                            if (ghost.direction === Direction.left) {
                                ghost.lastTurn = Direction.left;
                            }
                            if (ghost.direction === Direction.right) {
                                ghost.lastTurn = Direction.right;
                            }
                        }
                        else if (lastDirection === Direction.down) {
                            if (ghost.direction === Direction.left) {
                                ghost.lastTurn = Direction.right;
                            }
                            if (ghost.direction === Direction.right) {
                                ghost.lastTurn = Direction.left;
                            }
                        }
                        this.placeGhost(d.x, d.y, ghost);
                        this._map[p.x][p.y] = Sprite.nothing;
                        return;
                    }
                }
            }
        }
    }
};

Level.prototype.placeGhost = function (x, y, ghost) {
    this._map[x][y] = ghost.type;
    ghost.position.x = x;
    ghost.position.y = y;
};

Level.prototype.killGhost = function (x, y) {
    var ghost = this.ghost(x, y);
    if (ghost.alive) {
        for (var dy = y - 1; dy <= y + 1; dy++) {
            for (var dx = x - 1; dx <= x + 1; dx++) {
                if ((dx > 0) && (dx < 19) && (dy > 0) && (dy < 13)) {
                    if (this.isPlayer(dx, dy)) {
                        this._player.kill();
                    }
                    else {
                        if (this.isGhost(dx, dy)) {
                            this.ghost(dx, dy).alive = false;
                            this.score += 99;
                        }
                        this._map[dx][dy] = Sprite.nothing;
                    }
                }
            }
        }
        ghost.kill();
    }
};

Level.prototype.ghost = function (x, y) {
    for (var i = 0; i < this._ghosts.length; i++) {
        var ghost = this._ghosts[i];
        if ((x == ghost.position.x) && (y == ghost.position.y)) {
            return ghost;
        }
    }
    return null;
};

Level.prototype.getSpriteIndex = function (x, y, blink) {
    switch (this._map[x][y]) {
        case Sprite.nothing:
        case Sprite.uvexit:
        case Sprite.buffer:
        case Sprite.marker:
        case Sprite.uvstone:
            return 0;
        case Sprite.stone:
            return 1;
        case Sprite.ground:
            return 2;
        case Sprite.diamond:
            return 13 - ((blink + 4) % 6);
        case Sprite.wall:
            return 14;
        case Sprite.exit:
            return 32;
        case Sprite.changer:
            return 33;
        case Sprite.ghost90L:
        case Sprite.ghost90R:
        case Sprite.ghost90LR:
        case Sprite.ghost180:
            return this.ghost(x, y).getImageIndex();
        case Sprite.player:
            if (x == this._player.position.x && y == this._player.position.y) {
                return this._player.getImageIndex();
            }
            return 15;
    }
};

function Player(position) {
    this._direction = Direction.none;
    this.stone      = [false, false];
    this.step       = 0;
    this.alive      = true;
    this.position   = position;
};

Player.prototype.kill = function () {
    this.alive = false;
};

Player.prototype.animate = function () {
    this.step++;
    var max = 30;
    if (this.direction == Direction.left || this.direction == Direction.right) {
        max = 6;
    }
    if (this.direction == Direction.up || this.direction == Direction.down) {
        max = 2;
    }
    this.step = (this.step >= max) ? 0 : this.step;
};

Player.prototype.getImageIndex = function () {
    if (!this.alive) {
        return 31;
    }
    else if (this.direction === Direction.left && this.step < 6) {
        return [16, 17, 18, 19, 18, 17][this.step];
    }
    else if (this.direction === Direction.right && this.step < 6) {
        return [20, 21, 22, 23, 22, 21][this.step];
    }
    else if (this.direction === Direction.up && this.step < 2) {
        return [24, 25][this.step];
    }
    else if (this.direction === Direction.down && this.step < 2) {
        return [26, 27][this.step];
    }
    return [15, 15, 15, 15, 15, 15, 15, 15, 28, 28, 15, 15, 28, 28, 15, 15, 15, 15, 15, 15, 29, 29, 30, 30, 29, 29, 15, 15, 15, 15][this.step];
};

function Position(x, y) {
    this.x = x;
    this.y = y;
};

Position.prototype.equals = function (position) {
    return (this.x == position.x && this.y == position.y);
};

Position.prototype.clone = function () {
    return new Position(this.x, this.y);
};

var Sound = {
    "diamond": 0, "stone": 1, "step": 2
};

function SoundPlayer() {
    this._soundTable = {};
	this._audioElement = document.createElement('audio');
};

SoundPlayer.prototype.load = function (name, data) {
    var soundTable = this._soundTable;
	soundTable[name] = data;
};

SoundPlayer.prototype.play = function (name) {
    var sound = this._soundTable[name];
	
	// disable sound
	/*
	if ( sound )
	{
		this._audioElement.muted = "muted";
		this._audioElement.setAttribute('muted', 'muted');
		this._audioElement.crossOrigin = 'anonymous';
		this._audioElement.src = sound;
		this._audioElement.play();
		return true;
	}
	*/
    return false;
};





var levelData = [
    
`ZmZmZmZmZmZmZmUiIiIcEmIiJlZgEmZiERJiIiZWYCJlYhESYmZmVmAlZWYiIlJiIlZgJVVWZlIiYiFWZmZmVVZWZmIiVmERElVWVmVSIVZmFSBWVlZiUiFWYRWgZlZWYlIhVmYVIGVWVmJSIVZhFSBlUhJVUiFWZhUhZVISVVIiVmZmZmZmZmZmZmYBAECcQAQLUwAAAAAAAAAA`,
    "ZmZmZmZmZmZmZmoBAiIiIiIAARZmZgImZmFiVVVWYiICJlVhYiIiJmJRUSZVYWIAARZiJlZmVWFiVVVWYiZVVlVRYiIiJmImVlZVYWIiIiZiJlVmZmFiIiImYiZlVWwhIiIiJmIiZlYiJmZmIhZiIiZmIiIiIiEWYiACIiERVVVVVmZmZmZmZmZmZmYCnEA4QQEDQgAAAAAAAAAA",
    "ZmZmZmZmZmZmZmERERERERFhERZgAiIiIiIiYREWYAIiIiIiIm7u5mACZiIiIiEiIqZgAiImIiIlJSLGYAIiIiISIiElVm4iIiIiIiIiIiZgBlZWFVZmZmZmYAYGVhVWAAAAVmAGBlZlZgAAAFZgAAYGZWAAAABWYAAABmVVVVVVVmZmZmZmZmZmZmYDOEHUQRIGNgAAAAAAAAAA",
    "ZmZmZmZmZmZmZmVVVVVlFRUVFRZgAHAAYAcAAAAGYREREWIiIiIixmEREREiIiIiIiZu7u7iIiIRESImYiIiIiIiFRUiJmIiIiISImZmIiZhEREhEiIiJiIWYiIqIhESIhYSVmZmZiISIiVWUiZiISEiEiJSJiIWZRIiIRIhERYiVmZmZmZmZmZmZmYE1EGsUQULIAAAAAAAAAAA",
    "ZmZmZmZmZmZmZmFhVSIiJlVQASZqIiIlZlYiIGYmYGBgZmImAABiJmBgYGUBJgMAYmZgYGBmBmZhImUmY2BgYQZmFmBmBmBgYGY2IiVgxiZlYGBlBmAGYCYGYmBgZSFgBlBWJmViY2ZmYBZRVgZiZWABJmAmZmYmZWVlUlZgUgICBmZmZmZmZmZmZmYFrFHYTwEEICIAAAAAAAAA",
    "ZmZmZmbGZmZmZmIAAAAHAAAAAFZlZmZmZmZmZmYmYmUiIiIiIiJWVmViZmZmYmZmJiZiYmAAAPAABiZWZWJgZmZmZgYmJmJiYGAFUAYGJlZlYmAAYAYABiYmYmJmZmZmZmYmVmVlIiIiIiIiViZiZmZmamZmZmZWZQAAAAAAAAAAJmZmZmZmZmZmZmYG2E9wQgkNGDIAAAAAAAAA",
    "ZmZmZmZmZmZmZmEREREVVVa7u8ZiIiIi5VVWu7u2YwAAABVVVgu7tmIiIiLlVVYAAAZiIiIiFVVWEAAGYiIiImZmZhZmZmMQAiIiIiISIiZhEiIgIiIiEiImYRJSICIiIhIiJmEVVSAiIiISIiZhEREgIiIiEiImYqIiIyIiIiIiJmZmZmZmZmZmZmYHcEKoQwIOJiIiIiIiIiIh",
    "ZmZmZmZmZmZmZmIiIiIiIiIRIiZiEhISEhIiIiImYSEhISEhIiIiJmZmZmZmZgLiIiZiERERERHmIiImYiIiIiIiBiIiJmIiIiIiIAYiIiZiIiIiIgAGIiImYiIiIiAABiIiJmIiIiIiIiYiIiZiIiIiIiEWZmYmaiIiIiIiIiIiLGZmZmZmZmZmZmYIqEMMQwEOEQAAAAAAAAAA",
    "ZmZmZmZmZmZmZmIiIiJrAAAAAAZjADAFZmBmZgMGYiImJmAAAAYABmAANrZmJmYGMAZiIiYGMAAGBgMGYAMGBlVVVgYABmIiJgZVVTYGMAZgMAYGVVVWBgMGYiImBmZmZgYABmMABgAAAAAGMAZiIiZmZmZmZgAGaiImwAAAAAAABmZmZmZmZmZmZmYJDENERAEOFSIgMAICMCAg",
    "ZmZmZmZmZmZmZmIiIiIiIiIiIiZiIiIiIiIiIiImYiIiIiIiIiIiJmIiIiIiIiIiIiZiIiIiIiIiIiImYiIiIiIiIiIiJmIiIiIiIiIiIiZiIiIiIiIiIiIma7u7u7AAACEiJmu7u7uwAAABEiZlVVVVVVVVUiImbFVVVVVVVVIipmZmZmZmZmZmZmYQRER0UBIOJyIiIiIiIiIi",
    "ZmZmZmZmZmZmZmJiYmJiYmJiYmZiYmJiAmJiYmLGYmJiAgICYmJiBmJiAgICAgJiAgZiAgICsgICAgIGYgICsgKyAgICtmICsgICArICsgZisgICAgICsgIGYgICAmICAgICBmICAmJiYgICAmZiAmJiYmJiAmJmamJiYmJiYmJiZmZmZmZmZmZmZmYRdFDgRAEOAAAAAAAAAAAA",
    "ZmZmZmZmZmZmZmIREREREiIiJhZiIiIiIiIiIiYWYiIiIiIiIiImFmoiIiIiIiIiJiZiISEhBiIiIiImYiIiIgYiYiIiJmIiIiImImIAICZiIiEhJiJu7u7mYiIiIiIiYAAABmADAwAAAGAAAAZmYAADAABgAAAGbGUFIiIlYAAABmZmZmZmZmZmZmYS4ER8RQEGEjIgAAAAAAAA",
    "ZmZmZmZmZmZmZmISEhISEhISEhZhISEhISEhISEWYhISEhISEhISZmEhISEhISEhImZiEhISEhISEiJmYSEhISEhISZmZmIiIiIiIiIiIiZiIiImIiIiIiImYiIiJmAiIiIAtmIiIiZgZiIiIiZqIiImYG4iIiImbCIiJmBiIiIiJmZmZmZmZmZmZmYTfEUYRgENIDAAAAAAAAAA",
    "ZmZmZmZmZmZmZmsLAAICAgICAlZlVVUGAgICAgJWZmZmBgICAgICVmAAAAYyMjIyMlZgZmZmZmZmZmFWYAAABmxVIiJiJmZmZgBmZiIiYiZgAAAGZVUgAGImYGZmZmZmILBiJmAAAKZVVSAAYiZmZmYGZmYgsGImYAAABlVVIABiJmZmZmZmZmZmZmYUGEa0RgYMIyIRERIwAAAA",
    "ZmZmZmZmZmZmZmAAAlUSIhISEhZhIgJVUgISEiEmZRIAVVIiEhIhJmESAFZmIhISEhZhEgVmIiISEhIWZmAGZSIiIiIiJmFgFRVgAAAAAAZhYGZmVWMAMAA2YKBlVlVmAzAwBmZjZlZVVgMDMwZmAwZWZlYwAwA2ZszGVVVWMAAABmZmZmZmZmZmZmYVtEbsRwILMCIzMyIjIjMy",
    "ZmZmZmZmZmZmZmIVESJhFiIhIlZiFSIioiAAAmZmYhVmEgBgAAIhVmIRFhABYCIiISZiIVZgImIiMAIWZmYSBRVlYgMBJmIiElERZWIAMhZiZmZmZmZiAwEmYSERASVVESIiJm4RIiIiUiIiISZlJTAAABAAEhUWZQESUiEgDCFRVmZmZmZmZmZmZmYW7EckSQgEICMjMAAAAAAA",
    "ZmZmZmZmZmZmZmERYRFiIiwRERZiomERYAMGEREWYgJhEWAANmZVVmICYRFgAwZVVVZiAmERYDAGIiImYiJmFmMABiUiJmIiIiIiIiIiUiZiJVUiIiIiIiJWYiIiIhISIlJSJmIiIiISEiIiJSZmZmZmYmZmZmZmYwAAAABVVVVVVmZmZmZmZmZmZmYXJEkQUQIEICIzMwAAAAAA",
    "ZmZmZmZmZmZmZmBWAiYiAAVhEhZvZgYmJgUCYioWYAAGJiayAmImZmZmJiImAABiIiZiFiZmZmUAYRJmYVYlZSViAGISJmEWYmJmZgBgIiZlUAAAZQYAZRJmZiZmZmIGxmYiFmAAAAAABmYgEhZgZmZmAAYhIGZmYAVWVwAAAQADBmZmZmZmZmZmZmYYEFHASREEEgAiAAAAAAAA",
    "ZmZmZmZmZmZmZmEREREREiUVEiZiIiIiIiZmFiEmYiIiIiImthayJmpSUlJSJmYWVSZibu5iYiZWFmYmY2AAYmICIiIiJmJgAGJiAlISUiZiZmZiYgJSEiImYmVVYmICIhIiJmJlVWJiMlISIiZiZVViZmZiEiFWYiIiIyUiMhIlVmZmZmZmZmbGZmYZwEn4SgEGMQAAIAAAAAAA",
    "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",
    "ZmZmZmZmZmZmZmIiIiIiIiIiIiZiIiIiIiIiIiImYiIAciBwInACJmIiAAIgACIAAiZiIlACJQAiUAImYiIiIiIiIiIiJmIiIiIiIiIiIiZiIgACIAAiAAImYiJwAiBwIgByJmIiUAIlACJQACZiIiIiIiIiIiImbKIiIiIiIiIiJmZmZmZmZmZmZmY1wFRcVQIOBiIiIiIiIiIh",
    "ZmZmZmZmZmZmZmAAdiISJSxgAHZgAAYiEVIiYAAGZQACIRUSIiUABmZmZiVSIlJmZmZgAHYiIlUAYAB2YAAGIRIiImAABmUAAiEgAiIlAAZmZmYiIAISZmZmYiUmIiICIiAAdmJVJiIiIiJgAAZiIiIiIiISYAAGagImASJQImUABmZmZmZmZmZmZmY2XFX4VQEOFyIgMAICMCAg",
    "ZmZmZmZmZmZmZmFRVRUVVRFRURZlFVFRURVVFVVWYVVVUVVVFVUVFmVRVVUVFVVVUVZhVVUVUVFRUVUWZmYmZmZmZiZmZmAAAABgAAAAAMZgAAAAYAAAAAAGYAAAAGAAAAAABmAAAAAgAAAAAAZgAAAAYBARAAAGahVVFWFVFVAVVmZmZmZmZmZmZmY3+FWUVgEOZgAAAAAAAAAA",
    "ZmZmZmZmZmZmZmERERIhERERERZhERESACIiIiImYREREiIiIiIiJmERERIiIiIiIiZiIiIiIiIiIu7mYiIiIiIiIiIiJmAAACJQAAAAAAZgAAAiVQAAAAAGYAAAIlVQAAAABmImZmYiJmbiIiZnd3d3dwAAAiImZ3fHd3AAAAIgpmZmZmZmZmZmZmY4lFYwVxIOFiIiIiIAIiIi",
    "ZmZmZmZmZmZmZmwiIiIiIiIhIiZmYiIgAHACIhEmYGIiICIiAgEiJmpiIiAiIgIiIiZgZmVgZmYGAAAGYABlYAEAdlAABmAQZWBmZgZVAAZgZmVgZ3YGVVAGYGVVYGd2BlVVBmBlVWBgAAZVVVZgZmZgZmYGZmZmYAAAAP8AAAB3dmZmZmZmZmZmZmY5MFfMVwEGJDIgAAAAAAAA",
    "ZmZmZmZmZmZmZmBwYRERUREWAHxgAGURFRFRFgAGYABhFREVUVYABmAAYVFREREWAAZlAGERFRVRFlAGYiIiIiIiIiIiJmIiIiIiIiIiIiZiIiAAAAAAAiImYqIgAAAAAAIiJmZmYAAAAAAGZmZgcABwAHAAcAB2YAcABwAHAAcABmZmZmZmZmZmZmZCBFmgWQILESIzMyIjIjMy",
    "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",
    "ZmZmZmZmZmZmZmoAAGEAAAYiVVZiIiIlEAACIiIWYiIiEREAAAAiVmZmZmZmBmZmZmZhECJgAAAmFVFWZSIiUQAAJlFVFmZmZmVQACIiIiZiIiJlVQAiIiImYABwZmYGZmZmZmIiImAAAAYQIVZgECIgVQBSIiFWZSAibFIBFiIiJmZmZmZmZmZmZmZj4GV4ZgEDJAAAAABmZmZm",
    "ZmZmZmZmZmZmZmAAEAsAEAAAAAZgYmVmYGZmZmAGY2BmYlBsZVVgBmAQAAVgZhEWYAZgYAACZWIiImIGZVUABWpgAwBgBmZmUAJlZRUVYAZlZmUFZmIiImMGZWZmUmBiUVJgBmVmZmVgJVZVYAZlZmZmY2ZmZm4mZQAwBgAAAAAABmZmZmZmZmZmZmZkeGYQZwkINCAwEgBmZmZm",
    "ZmZmZmZmZmZmZmUhEABgAhIAAAZlIiAAYCEgAABmZSABAGFiAAAABmIAAiBlYCZmZgZgADACBWAAVVYGZmRGZmVgACFWBmAQEBBlYAEhVgZiISAgZWNRJma2YiLuImVgZmBmBmUAAAVlYGxgZgZlUABVZWBmYGYGZVUFVWoAAGAABmZmZmZmZmZmZmZlEGeoZwkONCAAAABmZmZm",
    "ZmZmZmZmZmZmZmAAAAAgAABWDBZgZmZgZmZiImYWYGVVYGVVYQZWJmBlZWBlZWIGVgZgZmVgZWZhBlYGb1VVamVVUgVmBmBmZmVmZiZmYAZgIiJmUAAwBWAGYAAAJWAAMAJeBmYSIiZSaWlpYAZlFRYWIi5eXlYGYVJVUVFSIiIlVmZmZmZmZmZmZmZnQGjYaAcIQQIwAABmZmZm",
    "ZmZmZmZmZmZmZmISIiIsIiIiISZiIiIiIiIiIiImYiIiIiIiIiIiJmIiIiIiIiIiIiZiIiIiuzsiIiImYiIiIvVfIiIiJmIiIiK1WyIiIiZiIiIie7ciIiImYiIiIiIiIiIiJmIiIiIiIiIiIiZiIiIiIiIiIiImYiIiIioiIiIiJmZmZmZmZmZmZmZpcGkQagkOAjMzMwAAAAAA",
    "ZmZmZmZmZmZmZmAABABURAAAQAZgBAAAQAQEQAAGZAQEREBEBAREVmAEAABAAAAEQEZgRAREQEBAAAAGYAAAAAAEBERERmREREBARAAAAAZgAEBAAAQEAEBWYEBARAREBERARmBAAEAABAAAAAZtREQARARAREBGagAAAAQAAABABmZmZmZmZmZmZmZwEGqoagEOAwAAAABmZmZm",
    "ZmZmZmZmZmZmZmERUSYiIiIiIiZiIiImMAAAACAGYLAABlVVVVVVVmIiIhYDAAAAAAZlVVVVVVVVVVVWYhISEhIAEhISFmEhISEhISEhISZiIiIiIiIiIiImYCIiIiIiIiIiJmMloAAAAAAAAAZgJQAAAAAAAAAGbBIiIiIiIiIiJmZmZmZmZmZmZmZyQGvgawQMKAAAAAAAAAAA",
    "ZmZmZmZmZmZmZmIiIiYRERYCIqZiEhImEREWAhImYSEhJhERFgIhJmISEiARERACIiZiIiImEWEWMwAGYDAAJmYWZiISJmIiIiIiIiIiIiZiIiIiIhISEhImZmbu7mIubmLmJmAAAABgADAAAAZlAAAAYAAAADAGZVAAAGAAMFAAxmZmZmZmZmZmZmZ1IG3AbRIDIBIiIgAAAAAA",
    "ZmZmZmZmZmZmZmEREWISEhEgCQZhERFiISEhIAkGYRERYRISESAJBmEREWIiIiIgCQZmERZiIiIiKgCWZmJmAzAAAiIiJmIiImIiIiIiIiZiIiJmZubmIiImZm7uYAawBlVVVmAAAAsGBrZRURZgAAALtjYGFVVWYAAAAAYABlFVxmZmZmZmZmZmZmZ2wG1gbg8HQCIAAAAAAAAA",
    "ZmZmZmZmZmZmZmIRwiIioiIiJlZiEWISEiISERZWYhFiEhIhIhEWVmIhJmZmIiIiJlZiIiYiIiADAAZWZiImJmViIiImVmIiJiZWYAMABlZgMAYiImZmZiFmYmZmYm7u7iICJmERESJgYAIiAiZu7u7iYGBiYgYmYiIiImBgsLACVmZmZmZmZmZmZmZ3YG4AbwoDJyIgAAAAAAAA",
    "ZmZmZmZmZmZmZmIiIhIiIqEiIhZhERIhESEiERImZVVQJVIlIlVbBmUiKyVRJSJSVSZlISAlJSUiURUWZVUgJSUlIlEVJmUiKyUiVSJRFRZlILAlIFUiURUmZREgJSslIlJVBmVVUCUABSJVUrZu7u7u7u7u7u7mbAAAAAAAAAAAxmZmZmZmZmZmZmaAQHAAAAwDdQAAAAAAAAAA"
];



</script>
</head>

<body bgcolor="#ffffff" onload="javascript:new Game(document.getElementById('gameArea'))">



<div id="gameArea">
</div>


</body>




</html>


