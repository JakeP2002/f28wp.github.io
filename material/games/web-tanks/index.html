
<!--

Web Programming Demo
(Tech demo)

Interactive and dynamic content in the browser 

Title: Web Tanks

Features:
1. Various sprite sheet animations 
2. Explore
3. Simple vector maths (rotation and direction)
4. Levels (ordering sprite animations in 2D/visuals - go under trees)


Future work 
Additional animation
Dynamic environment (change as the player navigates)
Online leaderboard
Complex problems (water, traps, roads, ...)
...


All the code/implementation is in one file

-->


<style>

* {
margin: 0;
padding: 0;
}
#popcontainer {
	text-align:center;
    width: 100%;
    height: 100%;
    position: absolute;
    visibility:hidden;
    background-color: rgba(22,52,22,0.7);
}

#popcontainer.show {
    visibility: visible;
    display: block;
}
.dialog {
    background:#e1e1e1; 
    margin: 0 auto;
    width:260px; 
    position:relative; 
    z-index:41;
    top: 25%;
    padding:30px; 
    -webkit-box-shadow:0 0 10px rgba(0,0,0,0.4);
    -moz-box-shadow:0 0 10px rgba(0,0,0,0.4); 
    box-shadow:0 0 10px rgba(0,0,0,0.4);
}

</style>


<div class="coins"> </div>

<style>
    .coins {
	  position: absolute;
      width: 75px;
      height: 75px;
      background-image: url("./imgs/coins2.png");
      animation: playX 2s steps(8) infinite,
                 playY 6s steps(3) infinite;
	  z-index: -15;
    }
    @keyframes playX {
      from {background-position-x: 0px;}
      to {background-position-x: -600px;}
    }
    @keyframes playY {
      from {background-position-y: 0px;}
      to {background-position-y: -225px;}
    }
</style>

<style>
    .coins2 {
      width: 75px;
      height: 75px;
      background-image: url("./imgs/coins2.png");
      animation: playX 2s steps(8) infinite;
    }
    @keyframes playX {
      from {background-position-x: 0px;}
      to {background-position-x: -600px;}
    }
</style>
	
<div id="bomb"></div>

<style>
#bomb {
    width: 320px;
    height: 240px;
    position : absolute;
    top : 50%;
    left : 50%;
    margin-top : -120px;
    margin-left: -160px;
    background-image: url("./imgs/bomber.png");
        
	animation: playbb 1s steps(19) forwards;
	animation-fill-mode: forwards;
}

@keyframes playbb {
    from { background-position: 0px; }
    to { background-position: -6080px; }
}

</style>


<style>
.wrapper
{ 
  padding: 20px;     
} 

@keyframes shadow-pulse
{
  0% {
    box-shadow: 0 0 0 0px rgba(0, 0, 0, 0.2);
  }
  100% {
    box-shadow: 0 0 0 35px rgba(0, 0, 0, 0);
  }
}

@keyframes shadow-pulse-big
{
  0% {
    box-shadow: 0 0 0 0px rgba(0, 0, 0, 0.1);
  }
  100% {
    box-shadow: 0 0 0 70px rgba(0, 0, 0, 0);
  }
}


.example-2
{
  margin: 75px 40px 0 40px;
  width: 130px;
  height: 60px;
  font: 13px/60px 'Barlow Semi Condensed', sans-serif;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: #fff;
  text-align: center;
  background: rgba(3, 3, 3, 0.6);
  border-radius: 3px;
  animation: shadow-pulse 1s 3;
}

.dialogbuttons {
	position:relative; 
	margin: 0 auto; 
	width:160px;
	top:30%;
}

</style>


<!--
<a href="#popcontainer" data-reveal-id="exampleModal">POP UP</a>
-->

<div id="popcontainer">
	<div id="dialogbody">
	
	</div>		
</div>




<div id="tank"></div>

<div id="snackbar">Some text some message..</div>






<style>
#snackbar {
  visibility: hidden;
  min-width: 250px;
  margin-left: -125px;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 2px;
  padding: 16px;
  position: fixed;
  z-index: 1;
  left: 50%;
  bottom: 30px;
  font-size: 17px;
}

#snackbar.show {
  visibility: visible;
  -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
  animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

@-webkit-keyframes fadein {
  from {bottom: 0; opacity: 0;} 
  to {bottom: 30px; opacity: 1;}
}

@keyframes fadein {
  from {bottom: 0; opacity: 0;}
  to {bottom: 30px; opacity: 1;}
}

@-webkit-keyframes fadeout {
  from {bottom: 30px; opacity: 1;} 
  to {bottom: 0; opacity: 0;}
}

@keyframes fadeout {
  from {bottom: 30px; opacity: 1;}
  to {bottom: 0; opacity: 0;}
}
</style>


<style>

#tank {
  position: absolute;
  left: 100px;
  top:  100px;
  width: 83px;   /* Viewport-width */
  height: 83px;   /* Viewport-height */
  background: transparent url('./imgs/tanks3.png') 0 0 no-repeat;   /* Our sprite as the viewport background */
  animation: tankanimation 1s steps(8) infinite; /* The Animation */
  z-index: -5;
  transform: rotate(45deg);
  transform-origin: 50% 50%;
}

/* Animation keyframes for the sprite */
@keyframes tankanimation {
  100% { background-position: -672px 0; }
}

.paused{
    -webkit-animation-play-state:paused !important;
    -moz-animation-play-state:paused !important;
    -o-animation-play-state:paused !important;;
    animation-play-state:paused !important;
}

.tree {
    width: 50px; /* Icon width */
    height: 50px; /* Icon height */
    display: inline-block; /* Display icon as inline block */
    background-position: -200px -301px; /* Icon background position in sprite */
	z-index: -2;
}


/*
Debug option - comment in to see all the div dimensions/details
*/
/* 
* {
border-style: dotted !important;
}
*/


</style>

<script>


var prev = {x:300, y:100};

var player = {
	pos: {x:300, y:100},
	dir: {x:0, y:0}
}

document.onkeypress = function()
{
	
};

function toDegrees(rad)
{
	return ( ( rad / Math.PI ) * 180.0 );
}

function toRadians(deg)
{
	return 0;
}

function cross(v1, v2)
{
    //console.log( (v1.x*v2.y) );
	//console.log( (v1.y*v2.x) );
    return ( (v1.x*v2.y) - (v1.y*v2.x) );
}

function sign( v )
{
	if ( v < 0 ) return -1;
	return 1;
}

document.onkeydown = keyDown;



function addTrack(ang)
{
	var dist = Math.abs( prev.x - player.pos.x ) +
			   Math.abs( prev.y - player.pos.y );
			   
	if ( dist < 71.0 )
	{
		return;
	}
	
	console.log( ang );
	
	prev.x = player.pos.x;
	prev.y = player.pos.y;
	
	var track = document.createElement("div");
	//track.id = "track"; 
	track.style.backgroundPosition = "-589px -80px";
	track.style.position = "absolute";
	track.style.top      = (player.pos.y - 8)+ 'px'; // "100px";
	track.style.left     = (player.pos.x - 1) + "px"; //"200px";
	track.style.width     = "82";
	track.style.height    = "102";
	track.style.margin   = '0px';
	track.style.zIndex  = -12;
	//track.style.zoom = "70%";

	//track.style.transform="rotate(45deg)";
	track.style.transform = "rotate(" + ang + "deg) scale( 0.7, 0.7 )";

	
	//track.style.transformOrigin = "200 200";
	//track.style.transform="rotate(45deg)";
	track.style.backgroundImage = "url('./imgs/sheet_tanks.png')";
	document.body.appendChild(track);
}

function snackBarMessage( msg ) {
  var x = document.getElementById("snackbar");
  x.className = "show";
  x.innerHTML = msg;
  setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
}

var shot = { 
			dir:{x:1,y:0}, 
			pos:{x:0,y:0}, 
			ang:0,
			id:-1,
			speed:15.0 };
			

			
var bullets = []
var count = 0;

function shoot()
{
	var shot2 = JSON.parse(JSON.stringify(shot))
	
	var bullet = document.createElement("div");
    bullet.id = "bullet" + (count++);	
	bullet.className       = "bullet";
	bullet.style.position  = "absolute";
	bullet.style.top       = (player.pos.y + 6) + "px";
	bullet.style.left      = (player.pos.x + 24) + "px";
	bullet.style.width     = "30";
	bullet.style.height    = "70";
	bullet.style.margin    = '0px';
	bullet.style.zIndex    = -4;
	bullet.style.backgroundPosition = "-365px -179px";
	bullet.style.backgroundImage = "url('./imgs/tanks3.png')";
	bullet.style.transform = "rotate(" + shot2.ang + "deg) scale( 0.7, 0.7 )";
	document.body.appendChild(bullet);	
	
	bullets.push( shot2 );
	bullets[ bullets.length - 1 ].id = bullet.id;
	bullets[ bullets.length - 1 ].pos.x = player.pos.x + 24;
	bullets[ bullets.length - 1 ].pos.y = player.pos.y + 6;

	
	
	//alert( 'aa' );
}

function calcAngleFromDir()
{
	
	//obj.style.transform="rotate(7deg)"
	
	if ( Math.abs( player.dir.x ) < 0.01 &&
	     Math.abs( player.dir.y ) < 0.01 )
		 {
			return;
		 }
	

	
	var len = Math.abs( player.dir.x + player.dir.y );
	
	var v1 = {x:0,                y:-1               };
	var v2 = {x:player.dir.x/len, y:player.dir.y/len };
	

	
	var cx = cross( v1, v2 );
	sn = sign( cx );
	
	var dot = v1.x*v2.x + v1.y*v2.y;
	var ang = Math.acos( dot );
	ang = toDegrees( ang ) * sn ;

	
	var obj = document.getElementById( "tank" );
	obj.style.transform="rotate(" + ang + "deg)"
	//console.log( "dot: " + dot + ", ang:" +  ang + ", cross:" + cx );
	
	shot.dir.x = v2.x;
	shot.dir.y = v2.y;
	shot.ang   = ang;
	
	//console.log( ang );
	
	//document.getElementById( "track" ).style.transform = "rotate(" + ang + "deg) scale( 0.7, 0.7 )";
	addTrack( ang );
}



function keyUp(e)
{
	var obj = document.getElementById( "tank" );	
	obj.classList.add( "paused" );
}

document.onkeyup = keyUp;


function keyDown(e) {

    e = e || window.event;

	player.dir = {x:0, y:0};
	
	var s = 10;
    if (e && e.keyCode == '38') { player.dir.y -= s; } // up arrow
    if (e && e.keyCode == '40') { player.dir.y += s; } // down arrow
    if (e && e.keyCode == '37') { player.dir.x -= s; } // left arrow
    if (e && e.keyCode == '39') { player.dir.x += s; } // right arrow
	if (e && e.keyCode == '27') { 
		if ( dialogStack.length <= 0 )
		{
			showDialog(pause); // esc key
		}
	}
	if (e && e.keyCode == '32') { shoot(); } // space
	player.pos.x += player.dir.x;
	player.pos.y += player.dir.y;
	
	calcAngleFromDir();
	
	var obj = document.getElementById( "tank" );
	obj.style.left = player.pos.x + "px";
	obj.style.top  = player.pos.y + "px";
	
	obj.classList.remove( "paused" );
	//document.getElementById( "track" ).style.left = player.pos.x + "px";
	//document.getElementById( "track" ).style.top  = player.pos.y + "px";
	//console.log( player.pos.x );
}

// no scroll bars
document.documentElement.style.overflow = 'hidden';  // firefox, chrome
document.body.scroll = "no"; // ie only
	
var num = 20;
for (var xx=0; xx<num; ++xx) // floor
for (var yy=0; yy<num; ++yy)
{
var newDiv = document.createElement("div"); 
newDiv.style.position = "absolute";
newDiv.style.top      = xx*128 + "px";
newDiv.style.left     = yy*128 + "px";
newDiv.style.width     = "128";
newDiv.style.height    = "128";
newDiv.style.margin   = '0px';
newDiv.style.zIndex  = -19;
newDiv.style.backgroundImage = "url('./imgs/sheet_tanks.png')";
document.body.appendChild(newDiv);
}

dialogStack = []

function showDialog( str )
{
	dialogStack.push( str )
	
	var bb = document.getElementById( "dialogbody");
	bb.innerHTML = str;
	
	//var tt = document.getElementById( "dialogtitle");
	//tt.innerHTML = "mytitle";
	
	//var bb = document.getElementById( "dialogbody");
	//bb.innerHTML = "mybody";
	
	var dd = document.getElementById( "popcontainer" );
	//dd.style.display = "block";
	dd.className = "show";
}

function closeDialog()
{
	var ss = dialogStack.pop();
	
	//alert( ss );
	if ( dialogStack.length <= 0 )
	{
		var dd = document.getElementById( "popcontainer" );
		dd.className = "";
		
		snackBarMessage("Get going....");
		return;
	}
	
	ss = dialogStack.pop();

	
	showDialog( ss );
	
	//var bb = document.getElementById( "dialogbody");
	
	//while (bb.hasChildNodes()) {  
	//  bb.removeChild(bb.firstChild);
	//}
	
	//bb.innerHTML = ss;
	
	//var bb = document.getElementById( "dialogbody");
	
}

var pause = `
	<br><br>
	<div class="dialog">
		 <h2>Paused</h2> 
		 <br>
		 <font size="4">
		 Resting?...
		 </font>
		<button class="example-2" onclick="closeDialog();">Back</button>
	</div>
`;

var options = `
	<br><br>
	<div class="dialog">
		 <h2>Options</h2> 
		 <br>
		 <font size="4">
		 Web Programming Demo
		 <br>
		 <br>
		 Game: In the Year 2120 planet Earth has been decimated.
		 A number of super tanks travel the land in search of ....
		 <br>
		 <br>
		 Controls: Cursor keys to move around, collect powerups, ...
		 </font>
		<button class="example-2" onclick="closeDialog();">Back</button>
	</div>
`;

var play = `<div class="dialogbuttons">
			<button class="example-2" onclick="closeDialog();">Play</button>
				 
			<button class="example-2" onclick="showDialog(options);">Options</button>
			</div>`;
			
showDialog(play);


snackBarMessage("Welcome to web tanks...");


keyDown(null);
keyUp(null);

function animationLoop()
{
	for (var kk=0; kk<bullets.length; ++kk)
	{
		var bb = document.getElementById( bullets[kk].id );
		
		bullets[kk].pos.x += bullets[kk].dir.x * bullets[kk].speed;
		bullets[kk].pos.y += bullets[kk].dir.y * bullets[kk].speed;
		
		bb.style.left = bullets[kk].pos.x + 'px';
		bb.style.top  = bullets[kk].pos.y + 'px';
		
	}
}

setInterval(animationLoop, 100);


function getRandomIntInclusive(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min + 1)) + min; //The maximum is inclusive and the minimum is inclusive 
}


for (var ii=0; ii<10; ++ii)
{
	var tree = document.createElement("div"); 
	tree.className = "tree";
	tree.style.position = "absolute";
	tree.style.top      = getRandomIntInclusive(10, document.body.clientWidth ) + "px";
	tree.style.left     = getRandomIntInclusive(10, document.body.clientHeight) + "px";
	tree.style.width     = "96";
	tree.style.height    = "107";
	tree.style.margin   = '0px';
	tree.style.zIndex   = -2;
	tree.style.backgroundImage = "url('./imgs/sheet_tanks.png')";
	document.body.appendChild(tree);
}

/*
var track = document.createElement("div");
track.id = "track2"; 
track.style.backgroundPosition = "-588px -78px";
track.style.position = "absolute";
track.style.top      = player.pos.y + "px";
track.style.left     = player.pos.x + "px";
track.style.width     = "83";
track.style.height    = "104";
track.style.margin   = '0px';
track.style.zIndex  = 19;
//track.style.zoom = "70%";

//track.style.transform = `scale( 70%, 70% ) rotate( 70deg )`;

track.style.transformOrigin = "50% 50%";
//track.style.transform="rotate(45deg)";
track.style.transform = "rotate(" + 0 + "deg) scale( 0.7, 0.7 )";
track.style.backgroundImage = "url('./imgs/sheet_tanks.png')";
document.body.appendChild(track);
*/

</script>











